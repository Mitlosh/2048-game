const e=new class{constructor(e){this.score=0,this.status="playing",this.highscore=Number(localStorage.getItem("highscore"))||0,e?this.board=e.map(e=>e.slice()):this.start()}_updateHighscore(){this.score>this.highscore&&(this.highscore=this.score,localStorage.setItem("highscore",this.highscore))}_addRandomTile(){let e=[];for(let t=0;t<this.board.length;t++)for(let s=0;s<this.board[t].length;s++)0===this.board[t][s]&&e.push([t,s]);if(0===e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)],r=.9>Math.random()?2:4;this.board[t][s]=r}_slideAndMergeRow(e){let t=e.filter(e=>0!==e);for(let e=0;e<t.length;e++)t[e]===t[e+1]&&(t[e]*=2,t[e+1]=0,this.score+=t[e],this._updateHighscore());let s=t.filter(e=>0!==e);for(;s.length<4;)s.push(0);return s}arraysEqual(e,t){return e.length===t.length&&e.every((e,s)=>e===t[s])}transpose(e=this.board){return e[0].map((t,s)=>e.map(e=>e[s]))}move(e){let t;let s=this.getState();switch(e){case"left":t=this._moveLeftInternal();break;case"right":t=this._reverseBoard(),t=this._moveLeftInternal(t),t=this._reverseBoard(t);break;case"up":t=this.transpose(),t=this._moveLeftInternal(t),t=this.transpose(t);break;case"down":t=this.transpose(),t=this._reverseBoard(t),t=this._moveLeftInternal(t),t=this._reverseBoard(t),t=this.transpose(t)}this._boardsEqual(s,t)||(this.board=t,this._addRandomTile()),this.checkGameStatus()}moveLeft(){this.move("left")}moveRight(){this.move("right")}moveUp(){this.move("up")}moveDown(){this.move("down")}_moveLeftInternal(e=this.board){return e.map(e=>this._slideAndMergeRow(e))}_reverseBoard(e=this.board){return e.map(e=>[...e].reverse())}_boardsEqual(e,t){return e.every((e,s)=>this.arraysEqual(e,t[s]))}getScore(){return this.score}getState(){return this.board.map(e=>e.slice())}getHighscore(){return this.highscore}getStatus(){return this.status}checkGameStatus(){this.checkGameOver()?this.status="lose":this.checkGameWin()&&(this.status="win")}start(){this.board=[,,,,].fill().map(()=>[,,,,].fill(0)),this.score=0,this.status="playing",this._addRandomTile(),this._addRandomTile()}restart(){this.start()}checkGameWin(){return this.board.some(e=>e.includes(2048))}checkGameOver(){if(this.board.flat().includes(0))return!1;for(let e=0;e<4;e++)for(let t=0;t<4;t++){let s=this.board[e][t];if(e<3&&this.board[e+1][t]===s||t<3&&this.board[e][t+1]===s)return!1}return!0}};let t=!1,s=0,r=0,o=0,i=0;const a=document.querySelectorAll(".field-cell"),n=document.querySelector(".button.start"),h=document.querySelector(".game-score"),l=document.querySelector(".best-score"),c=document.querySelector(".message-lose"),d=document.querySelector(".message-win"),u=document.querySelector(".message-start"),m=document.querySelector(".game-field");function g(){n.classList.remove("start"),n.classList.add("restart"),n.textContent="Restart",u.classList.add("hidden")}function v(){e.getState().forEach((e,t)=>{e.forEach((e,s)=>{let r=a[4*t+s];r.textContent=e||"",r.className="field-cell",e&&r.classList.add(`field-cell--${e}`)})}),h.textContent=e.getScore(),l.textContent=e.getHighscore(),d.classList.add("hidden"),c.classList.add("hidden"),function(){let t=e.getStatus();"win"===t&&d.classList.remove("hidden"),"lose"===t&&c.classList.remove("hidden")}()}function f(t,s){g(),["win","lose"].includes(e.getStatus())||(Math.abs(t)>Math.abs(s)?t>30?e.moveRight():t<-30&&e.moveLeft():s>30?e.moveDown():s<-30&&e.moveUp(),v())}document.addEventListener("keydown",s=>{if(t||(t=!0,setTimeout(()=>t=!1,100),g(),["win","lose"].includes(e.getStatus())))return;let r={ArrowLeft:()=>e.moveLeft(),ArrowRight:()=>e.moveRight(),ArrowUp:()=>e.moveUp(),ArrowDown:()=>e.moveDown()}[s.key];r&&(r(),v())}),m.addEventListener("touchstart",e=>{e.preventDefault();let t=e.touches[0];s=t.clientX,r=t.clientY},{passive:!1}),m.addEventListener("touchend",e=>{e.preventDefault();let t=e.changedTouches[0];o=t.clientX,i=t.clientY,f(o-s,i-r)},{passive:!1});let p=!1;m.addEventListener("mousedown",e=>{p=!0,s=e.clientX,r=e.clientY}),m.addEventListener("mouseup",e=>{p&&(p=!1,o=e.clientX,i=e.clientY,f(o-s,i-r))}),n.addEventListener("click",()=>{g(),e.start(),v()}),v();
//# sourceMappingURL=index.9af1d590.js.map
