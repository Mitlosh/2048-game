!function(){function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}function t(t,r){if(t){if("string"==typeof t)return e(t,r);var n=Object.prototype.toString.call(t).slice(8,-1);if("Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return e(t,r)}}var r=new/*#__PURE__*/(function(){var r;function n(e){!function(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}(this,n),this.score=0,this.status="playing",this.highscore=Number(localStorage.getItem("highscore"))||0,e?this.board=e.map(function(e){return e.slice()}):this.start()}return r=[{key:"_updateHighscore",value:function(){this.score>this.highscore&&(this.highscore=this.score,localStorage.setItem("highscore",this.highscore))}},{key:"_addRandomTile",value:function(){for(var e=[],r=0;r<this.board.length;r++)for(var n=0;n<this.board[r].length;n++)0===this.board[r][n]&&e.push([r,n]);if(0!==e.length){var o,i=function(e){if(Array.isArray(e))return e}(o=e[Math.floor(Math.random()*e.length)])||function(e,t){var r,n,o=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=o){var i=[],a=!0,s=!1;try{for(o=o.call(e);!(a=(r=o.next()).done)&&(i.push(r.value),2!==i.length);a=!0);}catch(e){s=!0,n=e}finally{try{a||null==o.return||o.return()}finally{if(s)throw n}}return i}}(o,2)||t(o,2)||function(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),a=i[0],s=i[1],u=.9>Math.random()?2:4;this.board[a][s]=u}}},{key:"_slideAndMergeRow",value:function(e){for(var t=e.filter(function(e){return 0!==e}),r=0;r<t.length;r++)t[r]===t[r+1]&&(t[r]*=2,t[r+1]=0,this.score+=t[r],this._updateHighscore());for(var n=t.filter(function(e){return 0!==e});n.length<4;)n.push(0);return n}},{key:"arraysEqual",value:function(e,t){return e.length===t.length&&e.every(function(e,r){return e===t[r]})}},{key:"transpose",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.board;return e[0].map(function(t,r){return e.map(function(e){return e[r]})})}},{key:"move",value:function(e){var t,r=this.getState();switch(e){case"left":t=this._moveLeftInternal();break;case"right":t=this._reverseBoard(),t=this._moveLeftInternal(t),t=this._reverseBoard(t);break;case"up":t=this.transpose(),t=this._moveLeftInternal(t),t=this.transpose(t);break;case"down":t=this.transpose(),t=this._reverseBoard(t),t=this._moveLeftInternal(t),t=this._reverseBoard(t),t=this.transpose(t)}this._boardsEqual(r,t)||(this.board=t,this._addRandomTile()),this.checkGameStatus()}},{key:"moveLeft",value:function(){this.move("left")}},{key:"moveRight",value:function(){this.move("right")}},{key:"moveUp",value:function(){this.move("up")}},{key:"moveDown",value:function(){this.move("down")}},{key:"_moveLeftInternal",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.board;return t.map(function(t){return e._slideAndMergeRow(t)})}},{key:"_reverseBoard",value:function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.board;return r.map(function(r){return((function(t){if(Array.isArray(t))return e(t)})(r)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(r)||t(r)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).reverse()})}},{key:"_boardsEqual",value:function(e,t){var r=this;return e.every(function(e,n){return r.arraysEqual(e,t[n])})}},{key:"getScore",value:function(){return this.score}},{key:"getState",value:function(){return this.board.map(function(e){return e.slice()})}},{key:"getHighscore",value:function(){return this.highscore}},{key:"getStatus",value:function(){return this.status}},{key:"checkGameStatus",value:function(){this.checkGameOver()?this.status="lose":this.checkGameWin()&&(this.status="win")}},{key:"start",value:function(){this.board=[,,,,].fill().map(function(){return[,,,,].fill(0)}),this.score=0,this.status="playing",this._addRandomTile(),this._addRandomTile()}},{key:"restart",value:function(){this.start()}},{key:"checkGameWin",value:function(){return this.board.some(function(e){return e.includes(2048)})}},{key:"checkGameOver",value:function(){if(this.board.flat().includes(0))return!1;for(var e=0;e<4;e++)for(var t=0;t<4;t++){var r=this.board[e][t];if(e<3&&this.board[e+1][t]===r||t<3&&this.board[e][t+1]===r)return!1}return!0}}],function(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}(n.prototype,r),n}()),n=!1,o=0,i=0,a=0,s=0,u=document.querySelectorAll(".field-cell"),c=document.querySelector(".button.start"),l=document.querySelector(".game-score"),h=document.querySelector(".best-score"),f=document.querySelector(".message-lose"),d=document.querySelector(".message-win"),v=document.querySelector(".message-start"),m=document.querySelector(".game-field");function y(){c.classList.remove("start"),c.classList.add("restart"),c.textContent="Restart",v.classList.add("hidden")}function g(){var e;r.getState().forEach(function(e,t){e.forEach(function(e,r){var n=u[4*t+r];n.textContent=e||"",n.className="field-cell",e&&n.classList.add("field-cell--".concat(e))})}),l.textContent=r.getScore(),h.textContent=r.getHighscore(),d.classList.add("hidden"),f.classList.add("hidden"),"win"===(e=r.getStatus())&&d.classList.remove("hidden"),"lose"===e&&f.classList.remove("hidden")}function b(e,t){y(),["win","lose"].includes(r.getStatus())||(Math.abs(e)>Math.abs(t)?e>30?r.moveRight():e<-30&&r.moveLeft():t>30?r.moveDown():t<-30&&r.moveUp(),g())}document.addEventListener("keydown",function(e){if(!n&&(n=!0,setTimeout(function(){return n=!1},100),y(),!["win","lose"].includes(r.getStatus()))){var t={ArrowLeft:function(){return r.moveLeft()},ArrowRight:function(){return r.moveRight()},ArrowUp:function(){return r.moveUp()},ArrowDown:function(){return r.moveDown()}}[e.key];t&&(t(),g())}}),m.addEventListener("touchstart",function(e){e.preventDefault();var t=e.touches[0];o=t.clientX,i=t.clientY},{passive:!1}),m.addEventListener("touchend",function(e){e.preventDefault();var t=e.changedTouches[0];a=t.clientX,s=t.clientY,b(a-o,s-i)},{passive:!1});var p=!1;m.addEventListener("mousedown",function(e){p=!0,o=e.clientX,i=e.clientY}),m.addEventListener("mouseup",function(e){p&&(p=!1,a=e.clientX,s=e.clientY,b(a-o,s-i))}),c.addEventListener("click",function(){y(),r.start(),g()}),g()}();
//# sourceMappingURL=index.c85fbec2.js.map
